/** 
 * "PayPal Shoppign Cart" jQuery Plugin
 *
 * Author: flGravity
 * Created: 23/01/2012
 * Site: http://codecanyon.net/user/flGravity
 * Version: 2.3
 */

(function(a){a.fn.paypalshop=function(o){var e=this;var u={groupAnimationTime:500,groupAnimationStartDelay:100,groupAnimationShift:10,groupAnimationEasing:"easeOutCubic",productsScrollTime:500,productsScrollEasing:"easeInOutCubic",cartItemsScrollTime:400,cartItemsScrollEasing:"easeInOutCubic",cartSlideDownTime:300,cartSlideUpTime:600,cartSlideEasing:"easeOutQuint",currencySign:"$",numberPrecision:2,productBuyLimit:3,localStorage:true,localStorageName:"ppshop",pageRows:2,pageColumns:3,buttonsOpacity:0.7,priceHandler:function(){var s=this.price*this.quantity;this.checkout_price=s/this.quantity;return s},paypal:{business:"paypal@domain.com",currency_code:"USD",lc:"US","return":"http://www.domain.com/shop/",cbt:"Return to My Site",cancel_return:"http://www.domain.com/shop/",no_shipping:1}};a.extend(u,o);var q={};var i=null;var h=a(".shop-products > ul[id]",e);var v=a('<ul class="shop-groups"/>').appendTo(e);var d={prev:a("<a/>",{"class":"page-prev",title:"Previous Page",href:"#"}),next:a("<a/>",{"class":"page-next",title:"Next Page",href:"#"}),pn:a('<span class="page-number"/>')};a('<div class="page-scroll"/>').append(d.prev,d.pn,d.next).appendTo(e);var p={cart_header:a("<div/>",{"class":"cart-header"}).html('<p>Items: <span class="total-items"></span> Total: <span class="total-price"></span></p>'),cart_content:a("<div/>",{"class":"cart-content"}),list_header:a("<div/>",{"class":"list-header"}).html('<span class="col-number">No.</span><span class="col-name">Name</span><span class="col-quantity">Quantity</span><span class="col-price">Price</span><span class="col-remove">Remove</span>'),list_content:a("<div/>",{"class":"list-content"}),list_wrapper:a("<div/>",{"class":"list-wrapper"}),list_scroll:a("<div/>",{"class":"list-scroll"}).html('<a class="scroll-down" href="#" title="Scroll down">down</a><a class="scroll-up" href="#" title="Scroll up">up</a>'),cart_footer:a("<div/>",{"class":"cart-footer"}).html('<p>Your total purchase is: <span class="total-items"></span> items (<span class="total-price"></span>)</p><a class="clear-button" href="#">Clear</a><a class="checkout-button" href="#">PayPal Checkout</a>')};p.list_wrapper.append(p.list_content);p.cart_content.append(p.list_header,p.list_wrapper,p.list_scroll);p.self=a('<div class="shop-cart"/>').append(p.cart_header).append(p.cart_content).append(p.cart_footer).appendTo(e);h.each(function(x){var s=this.id.replace(/_/g," ");var y=a("<a />",{title:s,prod_id:this.id,href:"#"}).text(s);a("<li/>").append(y).appendTo(v);y.click(function(z){v.find(".active-group").removeClass("active-group");a(this).parent().addClass("active-group");h.css("display","none");i=a("#"+a(this).attr("prod_id"),e);i.css({top:0,display:"block"});i.children("li").each(function(A){a(this).css({top:parseInt((A+u.pageColumns)/u.pageColumns)*u.groupAnimationShift,opacity:0});a(this).delay(A*u.groupAnimationStartDelay).animate({top:0,opacity:1},u.groupAnimationTime,u.groupAnimationEasing)});i.current_page=1;i.pages=Math.ceil(i.children("li").length/(u.pageRows*u.pageColumns));g();z.preventDefault()});a(this).children("li").each(function(z){var A=a(this);A.attr("id","_p0"+z);A.find(".product-buy").click(function(E){var C="";if(a(this).attr("option")){var B=a(this).attr("option");if(isNaN(B)&&B.length>0){if(B.charAt(0)=="#"){C=a(this).closest(".product").find(B).val()||""}else{C=a(this).closest(".product").find("."+B).val()||""}}else{C=B}}var D={group:A.parent().attr("id"),id:A.attr("id"),option:C||"NA",quantity:parseInt(A.attr("minimum"+C),10)||1,minimum:parseInt(A.attr("minimum"+C),10)||1,skip:parseInt(A.attr("skip"+C),10)||1,name:A.attr("name"+C),price:parseFloat(A.attr("price"+C)),shipping:A.attr("shipping"+C),number:A.attr("number"+C),handling:A.attr("handling"+C)};r(D,true);E.preventDefault()}).fadeTo(0,0.7).hover(f(300,1),f(300,u.buttonsOpacity));if(u.currencySign){A.find(".product-currency").html(u.currencySign)}});if(x==0){v.children("li:eq(0)").addClass("active-group");i=a(this);i.current_page=1;i.pages=Math.ceil(i.children("li").length/(u.pageRows*u.pageColumns));g();c()}else{a(this).hide()}});if(u.localStorage){k();window.setInterval(k,3000)}d.prev.click(function(s){if(i.current_page>1){i.animate({top:"+="+h.parent().height()},u.productsScrollTime,u.productsScrollEasing);i.current_page--;g()}s.preventDefault()});d.next.click(function(s){if(i.current_page<i.pages){i.animate({top:"-="+h.parent().height()},u.productsScrollTime,u.productsScrollEasing);i.current_page++;g()}s.preventDefault()});a(".clear-button",p.cart_footer).css("opacity",u.buttonsOpacity).click(function(s){q={};b();n();a(".shop-cart .list-content",e).css("top",0);s.preventDefault()}).hover(f(300,1),f(300,u.buttonsOpacity));a(".checkout-button",p.cart_footer).css("opacity",u.buttonsOpacity).click(function(s){j();s.preventDefault()}).hover(f(300,1),f(300,u.buttonsOpacity));var t=e.height()+parseInt(e.css("paddingBottom"))+parseInt(e.css("paddingTop"));var l=parseInt(p.cart_header.height());p.self.hover(function(){p.cart_header.css("visibility","hidden");a(this).stop().animate({top:(t-a(this).height())+"px"},u.cartSlideUpTime,u.cartSlideEasing)},function(){a(this).stop().animate({top:(t-l)+"px"},u.cartSlideDownTime,u.cartSlideEasing,function(){p.cart_header.stop().css({visibility:"visible",opacity:0}).fadeTo("slow",1)})}).css("top",(t-l)+"px");a(".scroll-up, .scroll-down",p.list_scroll).click(function(z){var s=p.list_wrapper;var y=p.list_content;var x=-parseInt(y.css("top"));var A=y.height()-s.height();if(this.className=="scroll-down"&&x<A){if(A-x>s.height()){x+=s.height()}else{x=A}}if(this.className=="scroll-up"&&x>0){if(x>s.height()){x-=s.height()}else{x=0}}y.animate({top:-x},u.cartItemsScrollTime,u.cartItemsScrollEasing);z.preventDefault()});function f(x,s){return function(){a(this).stop().fadeTo(x,s)}}function r(y,s){if(!(y.group in q)){q[y.group]=new Object();q[y.group].length=0}var x=q[y.group];var A=y.id+"_"+y.option;if(A in x){if(x[A].quantity+x[A].skip<=u.productBuyLimit){x[A].quantity=x[A].quantity+x[A].skip}else{s=false}}else{x[A]=y;x.length+=1}b();n();if(s){var z=p.cart_header.height();a(".shop-cart",e).stop(false,true).animate({top:"+="+z},200).animate({top:"-="+z},200)}}function c(){var x=0;var A=0;for(var z in q){for(var y in q[z]){if(y=="length"){continue}var s=q[z][y];x+=s.quantity;A+=u.priceHandler.call(s)}}A=u.currencySign+A.toFixed(u.numberPrecision);a(".total-items",p.self).text(x);a(".total-price",p.self).html(A)}function b(){c();p.list_content.empty();for(var z in q){var x=0;p.list_content.append('<div class="list-group">'+z.replace(/_/g," ")+"</div>");for(var y in q[z]){if(y=="length"){continue}var s=q[z][y];var A=a("<p />").attr({id:s.group+"::"+(s.id+"_"+s.option),"class":(++x==q[z].length)?"last-in-list":""});A.append('<span class="col-number">'+x+'.</span><span class="col-name">'+s.name+'</span><span class="col-quantity"><a class="button-subtract" href="#" title="-1">-</a><span class="item-quantity">'+s.quantity+'</span><a class="button-add" href="#" title="+1">+</a></span><span class="col-price"><span class="item-price">'+u.priceHandler.call(s).toFixed(u.numberPrecision)+'</span></span><span class="col-remove"><a class="button-delete" href="#" title="Remove">&times;</a></span>');p.list_content.append(A);A.bind("click",function(C){var B=this;if(/button-delete/.test(C.target.className)){m(B)}else{if(/button-(add|subtract)/.test(C.target.className)){w(B,C.target.className)}}n();C.preventDefault()})}}}function w(y,s){var x=/(\w+)::(\w+)/.exec(y.id);var z=q[x[1]][x[2]];if(s.indexOf("add")!=-1){if(z.quantity+z.skip<=u.productBuyLimit){z.quantity+=z.skip}}if(s.indexOf("subtract")!=-1){if(z.quantity-z.skip>=z.minimum){z.quantity-=z.skip}}a(y).find(".item-quantity").text(z.quantity);a(y).find(".item-price").text(u.priceHandler.call(z).toFixed(u.numberPrecision));c()}function m(x){var s=/(\w+)::(\w+)/.exec(x.id);delete q[s[1]][s[2]];q[s[1]].length--;if(q[s[1]].length==0){delete q[s[1]]}b()}function g(){var s=i.current_page+"/"+i.pages;d.pn.text("Page: "+s);if(i.current_page==1){d.prev.fadeTo(200,0.2);d.prev.unbind("mouseleave mouseenter")}else{d.prev.fadeTo(200,u.buttonsOpacity);d.prev.hover(f(500,1),f(500,u.buttonsOpacity))}if(i.current_page==i.pages){d.next.fadeTo(200,0.2);d.next.unbind("mouseleave mouseenter")}else{d.next.fadeTo(200,u.buttonsOpacity);d.next.hover(f(500,1),f(500,u.buttonsOpacity))}}function j(){var s={cmd:"_cart",upload:1,no_note:0,bn:"JQPayPalShop_ShoppingCart_EC_US",tax:0,rm:2,custom:""};a.extend(s,u.paypal);var y=a("<form />");y.attr("action","https://www.paypal.com/cgi-bin/webscr");y.attr("method","post");y.attr("target","_blank");var E;for(var D in s){E=a('<input type="hidden" />');E.attr("name",D);E.attr("value",s[D]);y.append(E)}var z=0;var x={name:"item_name",quantity:"quantity",checkout_price:"amount",shipping:"shipping",number:"item_number",handling:"handling"};for(var C in q){for(var B in q[C]){if(B=="length"){continue}z++;for(var A in x){E=a('<input type="hidden" />');E.attr("name",x[A]+"_"+z);E.attr("value",q[C][B][A]);y.append(E)}}}e.append(y);y.submit();y.remove()}function n(){var s=false,x=false;if(window.localStorage&&window.localStorage.setItem){s=true}if(window.JSON&&window.JSON.stringify){x=true}if(u.localStorage&&s&&x){window.localStorage.setItem(u.localStorageName,JSON.stringify(q))}}function k(){if(window.localStorage&&window.localStorage.getItem){var s=window.localStorage.getItem(u.localStorageName);if(s){try{q=JSON.parse(s)}catch(x){q={}}b()}}}return this}})(jQuery);